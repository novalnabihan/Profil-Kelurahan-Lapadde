generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// ðŸ”¹ ENUMS BARU UNTUK STRUKTUR ORGANISASI
//
enum OrgUnit {
  LURAH                    // Lurah
  SEKLUR                   // Sekretariat Kelurahan
  KASI_PEMERINTAHAN        // Pemerintahan & Trantib
  KASI_KESEJAHTERAAN       // Kesejahteraan Rakyat
  KASI_PELAYANAN_UMUM      // Pelayanan Umum & Pemberdayaan
  MITRA_EKSTERNAL          // Babinsa, Bhabinkamtibmas, PLKB, dll
}


enum RoleCategory {
  MAIN      // inti (Lurah, Seklur, Kasi)
  STAFF     // staf pelaksana di kelurahan
  EXTERNAL  // mitra eksternal (Babinsa, Bhabinkamtibmas, dll)
}

//
// ðŸ”¹ MODELS
//
model SiteProfile {
  id            String   @id @default(uuid())
  about         String?
  vision        String?
  mission       String?
  complaintFlow String?
  officeMap     String?
  updatedAt     DateTime @updatedAt
}

model Facility {
  id          String   @id @default(uuid())
  name        String
  category    String   // "kantor", "sekolah", "masjid", "puskesmas", dll
  address     String?
  latitude    Float
  longitude   Float
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([category])
}

model Struktur {
  id           String       @id @default(uuid())
  name         String
  position     String
  unit         OrgUnit?      // sementara optional biar migrasi aman
  roleCategory RoleCategory? // sementara optional
  nip          String?
  phone        String?
  photoUrl     String?
  order        Int
  createdAt    DateTime @default(now())
}

model RtRw {
  id         String   @id @default(uuid())
  type       String   // "RW" atau "RT"
  number     String   // nomor RW/RT (contoh: "01", "02")
  
  // Relasi parent-child
  rwParentId String?
  rwParent   RtRw?    @relation("RTtoRW", fields: [rwParentId], references: [id], onDelete: Cascade)
  rtChildren RtRw[]   @relation("RTtoRW")
  
  // Info ketua
  leader     String
  phone      String?
  address    String?
  photoUrl   String?
  
  // Koordinat untuk map
  latitude   Float?
  longitude  Float?
  
  // Metadata
  order      Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([type])
  @@index([rwParentId])
  @@index([order])
}

model Event {
  id        String   @id @default(uuid())
  title     String
  slug      String   @unique
  content   String
  imageUrl  String?
  eventDate DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Admin {
  id    String @id     // Supabase User UID
  email String @unique // Email admin
}
